{% extends "base.html" %}
{% block title %}Alunos{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Selo de debug para confirmar que este template está sendo renderizado -->
  <div class="alert alert-info py-1 mb-3">
    <strong>DEBUG_RENDER_ALUNOS_LISTAR</strong>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="m-0">Alunos</h3>
    <a href="{{ url_for('alunos_novo') }}" class="btn btn-primary">Cadastrar aluno</a>
  </div>

  {% if alunos|length == 0 %}
    <div class="alert alert-secondary">Nenhum aluno cadastrado.</div>
  {% else %}
    <div class="list-group">
      {% for aluno in alunos %}
        <div class="list-group-item list-group-item-action bg-dark text-white border-secondary">
          <div class="row align-items-center g-2">

            <!-- FOTO -->
            <div class="col-auto">
              {% if aluno.foto_path %}
                <img src="{{ url_for('uploads', filename=aluno.foto_path) }}"
                     alt="Foto de {{ aluno.nome }}" class="rounded" style="width:56px;height:56px;object-fit:cover;">
              {% else %}
                <div class="bg-secondary rounded d-flex align-items-center justify-content-center"
                     style="width:56px;height:56px;">
                  <span class="small text-dark text-center">sem<br>foto</span>
                </div>
              {% endif %}
            </div>

            <!-- DADOS -->
            <div class="col">
              <div class="d-flex flex-column">
                <strong class="lh-1">{{ aluno.nome }}</strong>
                <div class="text-secondary small mt-1">
                  {% if aluno.escola %}<span class="me-3">Escola: {{ aluno.escola }}</span>{% endif %}
                  {% if aluno.horario %}<span class="me-3">Horário: {{ aluno.horario }}</span>{% endif %}
                  {% if aluno.telefone_mae %}<span>Telefone da mãe: {{ aluno.telefone_mae }}</span>{% endif %}
                </div>
              </div>
            </div>

            <!-- AÇÕES (sem condições; backend valida permissão) -->
            <div class="col-auto d-flex gap-2">
              <a href="{{ url_for('alunos_editar', id=aluno.id) }}" class="btn btn-light btn-sm">
                Editar
              </a>
              <form method="post" action="{{ url_for('alunos_excluir', id=aluno.id) }}"
                    onsubmit="return confirm('Confirma excluir {{ aluno.nome }}?');">
                <button class="btn btn-danger btn-sm">Excluir</button>
              </form>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

</div>
{% endblock %}
