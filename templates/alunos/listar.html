{% extends 'base.html' %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="mb-0">Alunos</h3>
  {% if can('ALUNO_CRIAR') %}
  <a class="btn btn-light" href="{{ url_for('alunos_novo') }}">Novo Aluno</a>
  {% endif %}
</div>

<div class="card bg-dark border-secondary">
  <div class="card-body p-0">
    <table class="table table-dark table-striped table-hover align-middle mb-0">
      <thead>
        <tr>
          <th style="width:64px;">Foto</th>
          <th>Nome</th>
          <th>Escola</th>
          <th>Série</th>
          <th>Horário</th>
          <th>Telefone</th>
          <th class="text-end">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for a in items %}
        <tr>
          <td>
            {% if a.foto_path %}
              <img src="{{ a.foto_path }}" alt="foto {{ a.nome }}" style="width:48px;height:48px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.15);" />
            {% else %}
              <div style="width:48px;height:48px;border-radius:8px;background:#2b2f33;border:1px solid rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-weight:700;">
                {{ a.nome[:1]|upper }}
              </div>
            {% endif %}
          </td>
          <td>{{ a.nome }}</td>
          <td>{{ a.escola.nome if a.escola }}</td>
          <td>{{ a.serie.nome if a.serie }}</td>
          <td>
            {% if a.horario %}
              {{ a.horario.hora_inicio }}–{{ a.horario.hora_fim }}
            {% endif %}
          </td>
          <td>
            {% if a.telefone_cel %}<span class="me-2">{{ a.telefone_cel }}</span>{% endif %}
            {% if a.telefone_fixo %}<span class="text-secondary">{{ a.telefone_fixo }}</span>{% endif %}
          </td>
          <td class="text-end">
            {% if can('ALUNO_EDITAR') %}
            <a class="btn btn-sm btn-outline-light" href="{{ url_for('alunos_editar', id=a.id) }}">Editar</a>
            {% endif %}
            {% if can('ALUNO_EXCLUIR') %}
            <form class="d-inline" method="post" action="{{ url_for('alunos_excluir', id=a.id) }}" onsubmit="return confirm('Excluir este aluno?');">
              <button class="btn btn-sm btn-outline-danger">Excluir</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="text-center text-secondary py-4">Nenhum aluno cadastrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
